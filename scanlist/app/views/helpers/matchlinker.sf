<?php


class matchlinkerhelper extends Helper

{
  var $html;

function generate_opac_links($bhlplace, $ctrl_035, $ctrl_oclc, $ctrl_001)
{


# BS - get bib id and select all 035s (or 001 if empty) and places for each id which matches from holdings table.
       # have logic for each institution which creates a canned link by id
       # return as an multi array with 1st element institution code, 2nd the canned url.

			    #replace all tabs with spaces in ctrlnum first

			    # first, see whether to use an 035, oclc or 001 dependent on whichever one exists first in the q
			    if (strlen($ctrl_035) > 2)
			    {
			    $thecontrols = $ctrl_035;
			    $thedelimiter = "_";
			    }
			     elseif (strlen($ctrl_oclc) > 2)
			      {
			        $thecontrols = $ctrl_oclc;
			        $thedelimiter = "_";
			      }
			      elseif (strlen($ctrl_001) > 2)
			        {
			        $thecontrols = $ctrl_001;
			        $thedelimiter = " ";
			        }
			         else
			          { $thecontrols = NULL; }


                # may have a section here to override the above fields for certain sites. e.g if AMNH only can rely
                # on 001 to have a real control number (even if there is content in another field.

					# echo them all using direct url syntax as appropriate
                    $html =''; // String to return
						// Initalise arrays for institutions control as some return more than one per match in 035 or oclc, delimited by underscore
						$controlnumbers = array();


						// Split multi-value database field on underscore into separate control numbers
						$controlnumbers  = split("_",$thecontrols);

                     if (strlen($thecontrols) > 2) // only continue if element is greater than length two.
                     {
						// Iterate through ctrl numbers...
							foreach ($controlnumbers as $controlnumber)
							{
							    # Loop through each institution and create a direct url based on bhl_place

							    switch ($bhlplace)
							    {

                                case "SIL":

                                // Check to see if it belongs to the Smithsonian...

								$html .= "<a class='actionbut' target='_blank' href=' ";

				                $html .= "http://siris-libraries.si.edu/ipac20/ipac.jsp?&menu=search&aspect=power&npp=20&ipp=20&profile=dial&ri=&oper=and&aspect=power&index=BIB&term=" . rtrim($controlnumber);
				                $html .=  "'>";
							    $html .=  "$bhlplace";
				  				$html .=  "</a>";

				                $html .=  "<BR/>";
                                break;

							    case "NHM":

								// Check to see if it belongs to the NHM...

							    // only generate an url if Sirsi is not in $controlnumber

                                if (preg_match ("/\(Sirsi\)/", $controlnumber) == 0)
                                {

									$html .= "<a class='actionbut' target='_blank' href=' ";

									$html .=  "http://unicorn.nhm.ac.uk/uhtbin/cgisirsi/x/0/0/5?searchdata1=" . rtrim($controlnumber)  . "&srchfield1=CKEY";
									$html .=  "'>";
									$html .=  "$bhlplace";
									$html .=  "</a>";

									$html .=  "<BR>";
									}
                                break;


                                case "FIELD":

                                // Check to see if it belongs to the Field museum...

								   $html .=  "$bhlplace";
								   $html .=  "<BR/>";
									   break;

                                case "MOBOT":

                                // Check to see if it belongs to the MOBOT  museum...

								   $html .=  "$bhlplace";
								   $html .=  "<BR/>";

									   break;

                                case "AMNH":

                                // Check to see if it belongs to the AMNH  museum...

								   $html .=  "$bhlplace";
								   $html .=  "<BR/>";

								   break;

                                case "HAR":

                                // Check to see if it belongs to the HARVARD  lib...
								   $html .=  "$bhlplace";
								   $html .=  "<BR/>";
								   break;

                                case "KEW":

                                // Check to see if it belongs to the KEW  museum...

								   $html .=  "$bhlplace";
								   $html .=  "<BR/>";

								   break;

                                case "NYBG":

                                // Check to see if it belongs to the NYBG museum...

								   $html .=  "$bhlplace";
								   $html .=  "<BR/>";
									   break;

                                case "MBL":

                                // Check to see if it belongs to the MBL  lib...

								   $html .=  "$bhlplace";
								   $html .=  "<BR/>";
									   break;


							   // Add additional clauses for additional institutions here

                               default:

                               $html .=  "$bhlplace";
                               $html .=  "<BR/>";


                               } // end switch


							} // End foreach loop

                 }

                 return $html;
 			 } // End function / method
} // End class

?>
